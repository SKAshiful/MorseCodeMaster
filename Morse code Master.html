<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Master by Ashiful</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            position: relative;
        }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stats-bar { display: flex; justify-content: space-between; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 15px 20px; margin-bottom: 20px; color: white; flex-wrap: wrap; gap: 10px; }
        .stat-item { text-align: center; min-width: 80px; }
        .stat-value { font-size: 1.5rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.8rem; opacity: 0.8; }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #00f2fe, 0 0 20px #00f2fe; }
            50% { text-shadow: 0 0 10px #fff, 0 0 20px #4facfe, 0 0 30px #4facfe, 0 0 40px #4facfe; }
        }
        .glow-animation { animation: glow 2s ease-in-out; }

        .btn-sound {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 8px 12px;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
            border-radius: 50%;
            cursor: pointer;
            line-height: 1;
        }
        .btn-sound.off { opacity: 0.5; }

        .progress-container { background: rgba(255,255,255,0.2); border-radius: 20px; padding: 10px; margin-bottom: 30px; }
        .progress-bar { height: 20px; background: rgba(255,255,255,0.3); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px; transition: width 0.3s ease; width: 0%; }
        .progress-text { text-align: center; color: white; margin-top: 5px; font-size: 0.9rem; }
        .main-content { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .lesson-area { display: none; }
        .lesson-area.active { display: block; }
        .question-area { text-align: center; margin-bottom: 30px; }
        .question-type { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 20px; border-radius: 25px; display: inline-block; margin-bottom: 20px; font-weight: 600; }
        .question-text { font-size: 1.5rem; margin-bottom: 20px; min-height: 60px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 15px; padding: 20px; word-break: break-all; }
        .morse-display { font-family: 'Courier New', monospace; font-size: 1.5rem; letter-spacing: 0.2em; color: #2c3e50; }
        .input-area { margin-bottom: 30px; }
        .text-input { width: 100%; padding: 15px; font-size: 1.2rem; border: 2px solid #e1e8ed; border-radius: 10px; outline: none; transition: border-color 0.3s; }
        .text-input:focus { border-color: #667eea; }
        .morse-keyboard { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; max-width: 300px; margin-left: auto; margin-right: auto; }
        .morse-key { padding: 20px; font-size: 1.5rem; border: none; border-radius: 15px; cursor: pointer; transition: all 0.2s; font-weight: bold; color: white; }
        .dot-key { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .dash-key { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .space-key { background: linear-gradient(135deg, #fa709a, #fee140); grid-column: 1 / -1; }
        .morse-key:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .morse-key:active { transform: translateY(0); }
        .action-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-success { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .start-screen { text-align: center; }
        .start-screen h2 { margin-bottom: 20px; color: #2c3e50; }
        .daily-goal { background: linear-gradient(135deg, #ffecd2, #fcb69f); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .reference-section { display: none; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .reference-section.active { display: grid; }
        .morse-reference { background: #f8f9fa; border-radius: 15px; padding: 20px; }
        .morse-reference h3 { margin-bottom: 15px; color: #2c3e50; }
        .morse-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e1e8ed; }
        .morse-item:last-child { border-bottom: none; }
        .feedback { text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 600; }
        .feedback.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .navigation { text-align: center; margin-bottom: 20px; }
        .nav-btn { background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; margin: 0 10px; border-radius: 25px; cursor: pointer; transition: all 0.3s; }
        .nav-btn:hover, .nav-btn.active { background: white; color: #667eea; }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .stats-bar { justify-content: center; }
            .main-content { padding: 20px; }
        }
        .completion-screen { text-align: center; display: none; }
        .completion-screen.active { display: block; }
        .score-display { font-size: 3rem; color: #667eea; font-weight: bold; margin: 20px 0; }
        .morse-input-display { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; min-height: 60px; display: flex; align-items: center; justify-content: center; font-family: 'Courier New', monospace; font-size: 1.5rem; letter-spacing: 0.2em; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì° Morse Code Master</h1>
            <p>Learn Morse Code Through Interactive Practice</p>
            <button id="soundToggleBtn" class="btn-sound">üîä</button>
        </div>

        <div class="stats-bar">
            <div class="stat-item"><span class="stat-value" id="daysLearning">0</span><span class="stat-label">Days Learning</span></div>
            <div class="stat-item"><span class="stat-value" id="totalTime">0</span><span class="stat-label">Minutes Today</span></div>
            <div class="stat-item"><span class="stat-value" id="dailyGoal">5</span><span class="stat-label">Daily Goal</span></div>
            <div class="stat-item"><span class="stat-value" id="accuracy">0%</span><span class="stat-label">Accuracy</span></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="progress-text" id="progressText">Ready to start!</div>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('lesson', event)">Lesson</button>
            <button class="nav-btn" onclick="showSection('reference', event)">Reference</button>
        </div>

        <div class="main-content">
            <div class="start-screen" id="startScreen">
                <h2>Welcome to Your Morse Code Journey!</h2>
                <p>Choose a mode below to start your practice session.</p>
                <div class="daily-goal">
                    <h3>üéØ Today's Goal</h3>
                    <p>Complete <span id="dailyGoalDisplay">5</span> lessons with 80%+ accuracy</p>
                    <p>Progress: <span id="dailyProgress">0</span>/<span id="dailyGoalCount">5</span></p>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="startLesson('alphabet')">üöÄ Alphabet</button>
                    <button class="btn btn-primary" onclick="startLesson('numbers')">üî¢ Numbers</button>
                    <button class="btn btn-primary" onclick="startLesson('symbols')">üî£ Symbols</button>
                    <button class="btn btn-primary" onclick="startLesson('sentence')">‚úçÔ∏è Sentences</button>
                    <button class="btn btn-success" onclick="startLesson('mixed')">üîÄ Mixed</button>
                </div>
            </div>

            <div class="lesson-area" id="lessonArea">
                <div class="question-area">
                    <div class="question-type" id="questionType">Text to Morse</div>
                    <div class="question-text" id="questionText">Ready!</div>
                </div>
                <div id="feedback" class="feedback" style="display: none;"></div>
                <div class="input-area" id="morseInputArea" style="display: none;">
                    <div class="morse-input-display" id="morseInputDisplay"></div>
                    <div class="morse-keyboard">
                        <button class="morse-key dot-key" onclick="addMorse('.')">‚Ä¢</button>
                        <button class="morse-key dash-key" onclick="addMorse('-')">‚Äî</button>
                        <button class="morse-key space-key" onclick="addMorse(' ')">Space</button>
                    </div>
                </div>
                <div class="input-area" id="textInputArea" style="display: none;">
                    <input type="text" class="text-input" id="textInput" placeholder="Type your answer here..." maxlength="100">
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="submitAnswer()">‚úì Submit</button>
                    <button class="btn btn-warning" onclick="clearInput()">üîÑ Clear</button>
                    <button class="btn btn-warning" onclick="skipQuestion()">‚è≠ Skip</button>
                </div>
            </div>

            <div class="completion-screen" id="completionScreen">
                <h2>üéâ Lesson Complete!</h2>
                <div class="score-display" id="finalScore">0%</div>
                <p id="completionMessage">Great job!</p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="startLesson(gameState.practiceMode)">üîÑ Another Lesson</button>
                    <button class="btn btn-success" onclick="showStartScreen()">üè† Home</button>
                </div>
            </div>

            <div class="reference-section" id="referenceSection">
                <div class="morse-reference"><h3>Letters</h3><div id="lettersReference"></div></div>
                <div class="morse-reference"><h3>Numbers</h3><div id="numbersReference"></div></div>
                <div class="morse-reference"><h3>Symbols</h3><div id="symbolsReference"></div></div>
            </div>
        </div>
    </div>

    <script>
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..',
            '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.',
            '.': '.-.-.-', ',': '--..--', '?': '..--..', '!': '-.-.--', "'": '.----.', '/': '-..-.', '(': '-.--.', ')': '-.--.-', '&': '.-...', ':': '---...', ';': '-.-.-.', '=': '-...-', '+': '.-.-.', '-': '-....-', '_': '..--.-', '"': '.-..-.', '$': '...-..-', '@': '.--.-.', ' ': '/'
        };
        const reverseMorseCode = Object.fromEntries(Object.entries(morseCode).map(([k, v]) => [v, k]));

        const sentenceParts =  {
  subjects: [
    "A BIRD", "A CHEF", "A CHILD", "A COMPUTER", "A DETECTIVE", "A DOCTOR", "A DOG", "A DRAGON", "A DREAM", "A GHOST", "A GIANT", "A HERO", "A JESTER", "A KNIGHT", "A LION", "A MACHINE", "A MONSTER", "A MOUNTAIN", "A MOUSE", "A MYSTERY", "A NINJA", "A PAINTER", "A PIRATE", "A ROBOT", "A SCIENTIST", "A SHADOW", "A SPY", "A STORM", "A STRANGER", "A THIEF", "A TIGER", "A TRAVELER", "A VILLAIN", "A WIZARD", "A WOLF", "AN ACTOR", "AN ALIEN", "AN ARCHITECT", "AN ARTIST", "AN ASTRONAUT", "AN ECHO", "AN EMPIRE", "AN ENGINE", "AN EXPLORER", "AN IDEA", "EVERYONE", "HIS FATHER", "HER MOTHER", "MY TEAM", "NOBODY", "ONE MAN", "OUR LEADER", "SOMEONE", "SOMETHING", "THE ADMIRAL", "THE AI", "THE APPRENTICE", "THE ASSASSIN", "THE BAKER", "THE BEAST", "THE CAPTAIN", "THE CAT", "THE CHAMPION", "THE CLOCK", "THE CLOUD", "THE COMPANY", "THE COUNCIL", "THE CREATURE", "THE CREW", "THE CRIMINAL", "THE CROWD", "THE CULT", "THE CYBORG", "THE DANCER", "THE DEMON", "THE DESERT", "THE EMPEROR", "THE ENEMY", "THE ENGINEER", "THE FACTORY", "THE FAMILY", "THE FOOL", "THE FOREST", "THE FOX", "THE FUGITIVE", "THE GALAXY", "THE GAMER", "THE GARDENER", "THE GENERAL", "THE GOVERNMENT", "THE GUARD", "THE GUARDIAN", "THE HACKER", "THE HEALER", "THE HUNTER", "THE INTRUDER", "THE INVENTOR", "THE ISLAND", "THE JANITOR", "THE JUDGE", "THE JUNGLE", "THE KING", "THE LIBRARIAN", "THE MAGE", "THE MECHANIC", "THE MERCHANT", "THE MOON", "THE OCEAN", "THE ORACLE", "THE OUTLAW", "THE PHOENIX", "THE PILOT", "THE PRESIDENT", "THE PRISONER", "THE PROFESSOR", "THE QUEEN", "THE REBEL", "THE RIVER", "THE SAGE", "THE SATELLITE", "THE SEA", "THE SHIP", "THE SINGER", "THE SOLDIER", "THE STAR", "THE SUN", "THE SURVIVOR", "THE SWARM", "THE SYSTEM", "THE TEACHER", "THE TRICKSTER", "THE UNIVERSE", "THE VAMPIRE", "THE VOLCANO", "THE WANDERER", "THE WARRIOR", "THE WATCHER", "THE WIND", "THE WORLD", "YOUR FRIEND"
  ],
  verbs: [
    "ACCEPTS", "ACHIEVES", "ADMIRES", "ADVANCES", "ALERTS", "ANALYZES", "ANSWERS", "APPROACHES", "ARRIVES", "ASKS", "ATTACKS", "ATTEMPTS", "AVOIDS", "AWAKENS", "BATTLES", "BECOMES", "BEGINS", "BELIEVES", "BENDS", "BETRAYS", "BREAKS", "BRINGS", "BUILDS", "BURNS", "BUYS", "CALLS", "CAPTURES", "CARRIES", "CATCHES", "CHANGES", "CHASES", "CHECKS", "CHOOSES", "CLAIMS", "CLEANS", "CLIMBS", "CLOSES", "COMMANDS", "COMPLETES", "CONFRONTS", "CONNECTS", "CONQUERS", "CONSIDERS", "CONSTRUCTS", "CONSUMES", "CONTINUES", "CONTROLS", "COOKS", "CREATES", "CROSSES", "CRIES", "DAMAGES", "DANCES", "DECIDES", "DEFEATS", "DEFENDS", "DEFINES", "DELIVERS", "DEMANDS", "DENIES", "DEPARTS", "DESCRIBES", "DESIRES", "DESTROYS", "DETECTS", "DIGS", "DIRECTS", "DISAPPEARS", "DISCOVERS", "DISCUSSES", "DREAMS", "DRINKS", "DRIVES", "DROPS", "EATS", "ELUDES", "ENTERS", "ESCAPES", "EVADES", "EXAMINES", "EXISTS", "EXPLAINS", "EXPLODES", "EXPLORES", "FACES", "FAILS", "FALLS", "FEARS", "FEELS", "FIGHTS", "FINDS", "FINISHES", "FIXES", "FLEES", "FLIES", "FOLLOWS", "FORGETS", "FORGIVES", "FORMS", "FREEZES", "GAINS", "GATHERS", "GIVES", "GOES", "GRABS", "GROWS", "GUARDS", "GUIDES", "HANDLES", "HAPPENS", "HEARS", "HELPS", "HESITATES", "HIDES", "HITS", "HOLDS", "HOPES", "HUNTS", "HURTS", "IGNORES", "IMAGINES", "INFLUENCES", "INFORMS", "INITIATES", "INSPECTS", "INSPIRES", "INVENTS", "INVESTIGATES", "JOKES", "JUGGLES", "JUMPS", "KEEPS", "KNOWS", "LAUGHS", "LAUNCHES", "LEADS", "LEARNS", "LEAVES", "LIFTS", "LIGHTS", "LIKES", "LISTENS", "LIVES", "LOOKS", "LOSES", "LOVES", "MAKES", "MANAGES", "MEETS", "MENDS", "MENTIONS", "MOVES", "NEEDS", "NEGOTIATES", "NOTICES", "OBEYS", "OBSERVES", "OFFERS", "OPENS", "ORDERS", "OWNS", "PAINTS", "PASSES", "PERFORMS", "PICKS", "PLANS", "PLAYS", "POINTS", "PONDERS", "PRACTICES", "PREDICTS", "PREPARES", "PRESENTS", "PREVENTS", "PROMISES", "PROTECTS", "PROVES", "PROVIDES", "PULLS", "PUNCHES", "PUNISHES", "PURSUES", "PUSHES", "QUESTIONS", "REACHES", "REACTS", "READS", "REALIZES", "RECEIVES", "REMEMBERS", "REPAIRS", "REPORTS", "REQUESTS", "RESCUES", "RETURNS", "REVEALS", "RULES", "RUNS", "RUSHES", "SABOTAGES", "SAILS", "SAVES", "SAYS", "SCANS", "SCARES", "SEARCHES", "SEES", "SEEKS", "SELLS", "SENDS", "SENSES", "SETS", "SHAKES", "SHARES", "SHINES", "SHOUTS", "SHOWS", "SHRINKS", "SHUTS", "SINGS", "SITS", "SLEEPS", "SMILES", "SOLVES", "SPEAKS", "SPINS", "STANDS", "STAYS", "STEALS", "STOPS", "STUDIES", "SUMMONS", "SURVIVES", "TAKES", "TALKS", "TEACHES", "TELLS", "TESTS", "THANKS", "THINKS", "THROWS", "TOUCHES", "TRAVELS", "TRUSTS", "TRIES", "TURNS", "UNDERSTANDS", "UNEARTHS", "UNLOCKS", "USES", "VANISHES", "VIEWS", "VISITS", "WAITS", "WAKES", "WALKS", "WANTS", "WARNS", "WASHES", "WATCHES", "WEARS", "WINS", "WISHES", "WONDERS", "WORKS", "WORRIES", "WRITES"
  ],
  objects: [
    "A BANANA", "A BOMB", "A BOOK", "A BOTTLE", "A BOX", "A BRIDGE", "A CASTLE", "A CAVE", "A CHAIR", "A CHALLENGE", "A CHOICE", "A CITY", "A CLUE", "A CODE", "A COIN", "A COMPASS", "A COMPUTER", "A CRYSTAL", "A CURE", "A CURSE", "A DAGGER", "A DOOR", "A DRUM", "A FEAST", "A FOREST", "A FORTRESS", "A FRIEND", "A FUTURE", "A GAME", "A GARDEN", "A GATE", "A GEM", "A GIFT", "A GHOST", "A GOAL", "A HAMMER", "A HINT", "A HOLE", "A HORSE", "A HOUSE", "A JOKE", "A JOURNEY", "A KEY", "A KINGDOM", "A KNOT", "A LABYRINTH", "A LAKE", "A LAMP", "A LAW", "A LEGEND", "A LETTER", "A LIE", "A LIGHT", "A LOCK", "A LOG", "A MAP", "A MASK", "A MAZE", "A MEAL", "A MEMORY", "A MESSAGE", "A MIRROR", "A MISSION", "A MONSTER", "A MONUMENT", "A MOUNTAIN", "A MYSTERY", "A NOTE", "A NUMBER", "AN ALLY", "AN ANSWER", "AN APPLE", "AN ARTIFACT", "AN ENEMY", "AN IDEA", "AN ILLUSION", "AN OBSTACLE", "AN OCEAN", "AN OFFER", "AN OMEN", "AN OPPORTUNITY", "AN ORB", "A PACT", "A PAINTING", "A PATH", "A PATTERN", "A PIECE", "A PILLAR", "A PLAN", "A PLANET", "A POEM", "A POISON", "A PORTAL", "A POTION", "A POWER", "A PRIZE", "A PROBLEM", "A PUZZLE", "A QUESTION", "A RECIPE", "A RELIC", "A REWARD", "A RIDDLE", "A RING", "A RIVER", "A ROAD", "A ROBOT", "A ROCKET", "A ROPE", "A RUIN", "A RUMOR", "A SECRET", "A SEED", "A SHADOW", "A SHIELD", "A SHIP", "A SONG", "A SPELL", "A SPHERE", "A SPIRIT", "A STAR", "A STATUE", "A STONE", "A STORM", "A STORY", "A SWORD", "A SYMBOL", "A SYSTEM", "A TALE", "A TARGET", "A TASK", "A TEMPEST", "A TEMPLE", "A THIEF", "A THOUGHT", "A THREAT", "A THRONE", "A TICKET", "A TIME MACHINE", "A TOOL", "A TOWER", "A TRAP", "A TREASURE", "A TREE", "A TRICK", "A TRUTH", "A TUNNEL", "A UNIVERSE", "A VILLAGE", "A VISION", "A VOICE", "A VOW", "A VOYAGE", "A WALL", "A WAND", "A WARNING", "A WATCH", "A WAVE", "A WEAPON", "A WHISPER", "A WINDOW", "A WISH", "A WORD", "A WOUND", "ANYTHING", "EVERYTHING", "HER CAR", "HIS SWORD", "HOME", "ITS CORE", "MY DESTINY", "NOTHING", "OUR PLAN", "SOMETHING", "THE ABYSS", "THE AIR", "THE ANSWER", "THE BALL", "THE BATTLE", "THE CROWN", "THE DARKNESS", "THE DAWN", "THE EARTH", "THE EDGE", "THE END", "THE FIRE", "THE FISH", "THE FLAME", "THE FLEET", "THE FOOD", "THE FORCE", "THE FRUIT", "THE FURY", "THE GAME", "THE GOLD", "THE GROUND", "THE HEART", "THE HORIZON", "THE ICE", "THE KEY", "THE LABYRINTH", "THE LIBRARY", "THE LIE", "THE LIFE", "THE LIGHT", "THE MACHINE", "THE MAGIC", "THE MAP", "THE MASK", "THE MAZE", "THE MOON", "THE MOUNTAIN", "THE MUSIC", "THE MYSTERY", "THE NIGHT", "THE OCEAN", "THE ORB", "THE PAST", "THE PLAN", "THE POWER", "THE PRIZE", "THE QUEEN", "THE RAIN", "THE REALITY", "THE RIVER", "THE ROAD", "THE RUINS", "THE SCEPTER", "THE SCROLL", "THE SEA", "THE SECRET", "THE SHADOW", "THE SHIELD", "THE SHIP", "THE SKY", "THE SOUL", "THE SOURCE", "THE STARS", "THE STONE", "THE STORM", "THE SUN", "THE SWORD", "THE THRONE", "THE TIDE", "THE TOWER", "THE TREASURE", "THE TRUTH", "THE UNKNOWN", "THE VOID", "THE WALL", "THE WAR", "THE WATER", "THE WAY", "THE WEATHER", "THE WIND", "THE WORLD", "THEIR FATE", "YOUR NAME"
  ],
  adjectives: [
    "ABANDONED", "ABNORMAL", "ABUNDANT", "ACCURATE", "ACTIVE", "ACTUAL", "ADAPTIVE", "ADMIRABLE", "ADVANCED", "ADVENTUROUS", "AFRAID", "AGELESS", "AGGRESSIVE", "AGILE", "ALARMED", "ALERT", "ALIEN", "ALIVE", "ALONE", "AMAZING", "AMBITIOUS", "ANCIENT", "ANGRY", "ANIMATED", "ANNOYING", "ANXIOUS", "AQUATIC", "ARTIFICIAL", "ASHAMED", "ATOMIC", "ATTENTIVE", "AUTHENTIC", "AUTOMATIC", "AVAILABLE", "AVERAGE", "AWAKE", "AWARE", "AWESOME", "AWFUL", "AWKWARD", "BAD", "BARE", "BEAUTIFUL", "BENEVOLENT", "BIG", "BIZARRE", "BLACK", "BLANK", "BLAZING", "BLEAK", "BLIND", "BLOODY", "BLUE", "BOILING", "BOLD", "BRAVE", "BRIGHT", "BRILLIANT", "BRITTLE", "BROAD", "BROKEN", "BROWN", "BURNING", "BUSY", "CALM", "CAREFUL", "CARELESS", "CAUTIOUS", "CELESTIAL", "CHAOTIC", "CHARMING", "CHEAP", "CHEERFUL", "CHEMICAL", "CHIEF", "CLEAN", "CLEAR", "CLEVER", "CLOSE", "CLOUDY", "CLUMSY", "COGNITIVE", "COLD", "COLORFUL", "COLOSSAL", "COMFORTABLE", "COMMON", "COMPLETE", "COMPLEX", "COMPOSED", "CONCRETE", "CONFIDENT", "CONFUSED", "CONSCIOUS", "CONSTANT", "CONTENT", "COOL", "CORRECT", "CORRUPT", "COURAGEOUS", "COWARDLY", "CRAFTY", "CRAZY", "CREATIVE", "CREEPY", "CRIMSON", "CRITICAL", "CROOKED", "CROWDED", "CRUEL", "CRYING", "CRYSTAL", "CURIOUS", "CURSED", "CURVED", "CYBERNETIC", "DANGEROUS", "DARK", "DAZZLING", "DEAD", "DEADLY", "DEAFENING", "DEAR", "DECENT", "DECEPTIVE", "DEEP", "DEFEATED", "DEFENSIVE", "DEFIANT", "DELICATE", "DELICIOUS", "DELIGHTED", "DEMONIC", "DENSE", "DEPENDABLE", "DEPRESSED", "DERANGED", "DESERTED", "DESPERATE", "DESTRUCTIVE", "DEVIOUS", "DIFFERENT", "DIFFICULT", "DIGITAL", "DILIGENT", "DIM", "DIRECT", "DIRTY", "DISGUSTING", "DISTANT", "DIVINE", "DIZZY", "DOUBLE", "DOUBTFUL", "DRAMATIC", "DREADFUL", "DREAMY", "DULL", "DUSTY", "DYNAMIC", "EAGER", "EARLY", "EASY", "ECCENTRIC", "ECHOING", "EFFECTIVE", "EFFICIENT", "ELASTIC", "ELATED", "ELDERLY", "ELECTRIC", "ELEGANT", "ELEMENTAL", "EMPTY", "ENCHANTED", "ENDLESS", "ENERGETIC", "ENORMOUS", "ENTIRE", "ETERNAL", "ETHEREAL", "EVIL", "EXACT", "EXCELLENT", "EXCITED", "EXHAUSTED", "EXOTIC", "EXPENSIVE", "EXPERT", "EXPRESS", "EXTRA", "EXTRAORDINARY", "FABULOUS", "FAINT", "FAIR", "FAITHFUL", "FAKE", "FALSE", "FAMILIAR", "FAMOUS", "FANCY", "FANTASTIC", "FAR", "FAST", "FATAL", "FAVORITE", "FEARFUL", "FEARLESS", "FEEBLE", "FIERCE", "FIERY", "FINAL", "FINE", "FIRM", "FIRST", "FLAWED", "FLAWLESS", "FLEETING", "FLEXIBLE", "FLUFFY", "FLUID", "FOCUSED", "FOGGY", "FOOLISH", "FORBIDDEN", "FOREIGN", "FORMAL", "FORMER", "FORTUNATE", "FOUL", "FRAGILE", "FRANTIC", "FREE", "FREEZING", "FREQUENT", "FRESH", "FRIENDLY", "FRIGHTENED", "FROZEN", "FULL", "FUNNY", "FURIOUS", "FUTURE", "FUZZY", "GALLANT", "GENEROUS", "GENTLE", "GENUINE", "GHOSTLY", "GIANT", "GIGANTIC", "GLAD", "GLASS", "GLEAMING", "GLOBAL", "GLOOMY", "GLORIOUS", "GLOWING", "GOLDEN", "GOOD", "GORGEOUS", "GRACEFUL", "GRAND", "GRATEFUL", "GRAVE", "GRAY", "GREAT", "GREEDY", "GREEN", "GRIM", "GROSS", "GUILTY", "HAGGARD", "HAIRY", "HALF", "HANDSOME", "HAPPY", "HARD", "HARMFUL", "HARMLESS", "HARSH", "HASTY", "HAUNTED", "HEALTHY", "HEARTBROKEN", "HEAVY", "HELPFUL", "HELPLESS", "HIDDEN", "HIDEOUS", "HIGH", "HOLLOW", "HOLY", "HONEST", "HOPEFUL", "HOPELESS", "HORRIBLE", "HOSTILE", "HOT", "HUGE", "HUMBLE", "HUMID", "HUNGRY", "HURT", "HUSHED", "ICY", "IDEAL", "IDENTICAL", "IDIOTIC", "IDLE", "IGNORANT", "ILL", "ILLEGAL", "IMAGINARY", "IMMEDIATE", "IMMENSE", "IMMORTAL", "IMPORTANT", "IMPOSSIBLE", "IMPRESSIVE", "IMPROPER", "IMPULSIVE", "INACTIVE", "INCREDIBLE", "INDESTRUCTIBLE", "INDIFFERENT", "INDIGO", "INEVITABLE", "INFINITE", "INFLUENTIAL", "INNOCENT", "INQUISITIVE", "INSANE", "INSIDE", "INSIGNIFICANT", "INTELLIGENT", "INTENSE", "INTERESTING", "INTERNAL", "INTRICATE", "INVINCIBLE", "INVISIBLE", "IRON", "IRRATIONAL", "IRREGULAR", "JAGGED", "JEALOUS", "JOLLY", "JOYFUL", "JOYOUS", "JUBILANT", "JUICY", "JUMBO", "JUMPY", "JUST", "KEEN", "KIND", "KNOWN", "LARGE", "LAST", "LATE", "LAUGHING", "LAVISH", "LAZY", "LEGAL", "LEGENDARY", "LIGHT", "LIQUID", "LITTLE", "LIVE", "LIVELY", "LIVING", "LOGICAL", "LONE", "LONELY", "LONG", "LOOSE", "LOUD", "LOVELY", "LOVING", "LOW", "LOYAL", "LUCKY", "LUMINOUS", "LUSH", "LUXURIOUS", "MAD", "MAGICAL", "MAGNETIC", "MAGNIFICENT", "MAJESTIC", "MAJOR", "MALEVOLENT", "MASSIVE", "MASTER", "MATERIAL", "MATURE", "MEAN", "MECHANICAL", "MEDICAL", "MEDIUM", "MELLOW", "MELTED", "MEMORABLE", "MENACING", "MENTAL", "MERCIFUL", "MERRY", "MESSY", "METALLIC", "MIGHTY", "MILD", "MILITARY", "MINDLESS", "MINIATURE", "MINOR", "MISERABLE", "MISSING", "MISTY", "MIXED", "MODERN", "MODEST", "MOLTEN", "MONSTROUS", "MORAL", "MOTIONLESS", "MUDDY", "MYRIAD", "MYSTERIOUS", "MYTHICAL", "NAIVE", "NARROW", "NASTY", "NATURAL", "NAUGHTY", "NEARBY", "NEAT", "NECESSARY", "NEGATIVE", "NERVOUS", "NEW", "NICE", "NIMBLE", "NOBLE", "NOISY", "NORMAL", "NOTABLE", "NUMEROUS", "OBEDIENT", "OBJECTIVE", "OBLIVIOUS", "OBVIOUS", "ODD", "OFFENSIVE", "OFFICIAL", "OLD", "OMINOUS", "ONLY", "OPEN", "OPPOSITE", "OPTIMISTIC", "ORANGE", "ORDERLY", "ORDINARY", "ORGANIC", "ORIGINAL", "OTHER", "OUTER", "OUTRAGEOUS", "PALE", "PARALLEL", "PASSIONATE", "PASSIVE", "PAST", "PATIENT", "PEACEFUL", "PERFECT", "PERILOUS", "PERSONAL", "PHYSICAL", "PLAIN", "PLAYFUL", "PLEASANT", "PLEASED", "POISONOUS", "POLITE", "POOR", "POPULAR", "POSITIVE", "POSSIBLE", "POWERFUL", "PRACTICAL", "PRECIOUS", "PRECISE", "PREHISTORIC", "PREMIUM", "PRESENT", "PREVIOUS", "PRIMARY", "PRIME", "PRIMITIVE", "PRIVATE", "PROBABLE", "PROFOUND", "PROPER", "PROUD", "PUBLIC", "PULSATING", "PUNGENT", "PUNY", "PURE", "PURPLE", "PUZZLED", "QUAINT", "QUICK", "QUIET", "RADIANT", "RADIOACTIVE", "RAGGED", "RARE", "RASH", "RAW", "READY", "REAL", "REALISTIC", "REASONABLE", "RECENT", "RECKLESS", "RED", "REFLECTIVE", "REGAL", "REGULAR", "RELAXED", "RELIABLE", "REMOTE", "REPULSIVE", "RESILIENT", "RESPONSIBLE", "RESTLESS", "REVERENT", "RICH", "RIGHT", "RIGID", "RIPE", "RISKY", "ROARING", "ROBOTIC", "ROBUST", "ROTTEN", "ROUGH", "ROUND", "ROYAL", "RUDE", "RUINED", "RUSHING", "RUSTIC", "RUSTY", "SAD", "SAFE", "SALTY", "SAME", "SANDY", "SANE", "SARCASTIC", "SATISFIED", "SAVAGE", "SCARED", "SCARLET", "SCATTERED", "SECRET", "SECURE", "SEDATIVE", "SELFISH", "SENSITIVE", "SENTIENT", "SEPARATE", "SERAPHIC", "SERENE", "SERIOUS", "SEVERE", "SHADOWY", "SHADY", "SHAKY", "SHALLOW", "SHAMEFUL", "SHAMELESS", "SHARP", "SHATTERED", "SHIMMERING", "SHINING", "SHINY", "SHOCKED", "SHORT", "SHY", "SICK", "SILENT", "SILKY", "SILLY", "SILVER", "SIMILAR", "SIMPLE", "SINCERE", "SINGLE", "SKELETAL", "SKEPTICAL", "SKILLED", "SLEEPY", "SLIM", "SLIMY", "SLOW", "SMALL", "SMART", "SMILING", "SMOOTH", "SNEAKY", "SOARING", "SOCIAL", "SOFT", "SOLID", "SOLITARY", "SOLEMN", "SOOTHING", "SORE", "SORROWFUL", "SORRY", "SOUND", "SOUR", "SPARKLING", "SPECIAL", "SPECTRAL", "SPICY", "SPIRITUAL", "SPLENDID", "SPOOKY", "SPOTTED", "SQUARE", "STABLE", "STALE", "STATIC", "STEADY", "STEALTHY", "STEAMY", "STEEL", "STEEP", "STICKY", "STIFF", "STILL", "STINGY", "STORMY", "STRANGE", "STRICT", "STRONG", "STUBBORN", "STUNNING", "STUPID", "STURDY", "SUBTLE", "SUDDEN", "SUNKEN", "SUNNY", "SUPER", "SUPERB", "SUPERIOR", "SUPERNATURAL", "SURE", "SURPRISED", "SUSPICIOUS", "SWEET", "SWIFT", "SYNTHETIC", "TALL", "TAME", "TANGIBLE", "TASTY", "TEARFUL", "TEMPORARY", "TENDER", "TENSE", "TERRIBLE", "TERRIFIC", "THANKFUL", "THICK", "THIN", "THIRSTY", "THOUGHTFUL", "THUNDEROUS", "TIDY", "TIGHT", "TINY", "TIRED", "TIRESOME", "TOUGH", "TOXIC", "TRAGIC", "TRANQUIL", "TRANSPARENT", "TREACHEROUS", "TREMBLING", "TRICKY", "TRUE", "TRUSTING", "TRUSTWORTHY", "TWISTED", "TYPICAL", "UGLY", "ULTIMATE", "UNARMED", "UNBEARABLE", "UNBELIEVABLE", "UNBROKEN", "UNCANNY", "UNCERTAIN", "UNCHANGED", "UNCLEAN", "UNCOMFORTABLE", "UNCOMMON", "UNCONSCIOUS", "UNCONTROLLED", "UNCONVENTIONAL", "UNDEAD", "UNDEFEATED", "UNDERGROUND", "UNEASY", "UNEXPECTED", "UNFAMILIAR", "UNFINISHED", "UNFORGETTABLE", "UNFORGIVABLE", "UNFORTUNATE", "UNFRIENDLY", "UNHAPPY", "UNHEALTHY", "UNHOLY", "UNIFIED", "UNIMPORTANT", "UNIQUE", "UNITED", "UNIVERSAL", "UNKNOWN", "UNLIKELY", "UNLUCKY", "UNNATURAL", "UNNECESSARY", "UNPLEASANT", "UNPREDICTABLE", "UNREAL", "UNRELIABLE", "UNSEEN", "UNSTABLE", "UNSTOPPABLE", "UNSURE", "UNUSUAL", "UNWILLING", "UNWISE", "UPSET", "URGENT", "USEFUL", "USELESS", "USUAL", "VACANT", "VAGUE", "VAIN", "VALID", "VALUABLE", "VANISHING", "VAST", "VENGEFUL", "VENOMOUS", "VERTICAL", "VICIOUS", "VICTORIOUS", "VIGILANT", "VILLAINOUS", "VIOLENT", "VIOLET", "VIRTUAL", "VIRTUOUS", "VISIBLE", "VITAL", "VIVID", "VOLATILE", "VOLUNTARY", "VORACIOUS", "VULNERABLE", "WANDERING", "WARM", "WARY", "WASTED", "WATCHFUL", "WATERY", "WEAK", "WEALTHY", "WEARY", "WEIRD", "WELCOME", "WET", "WHISPERING", "WHITE", "WHOLE", "WICKED", "WIDE", "WILD", "WILLING", "WINDY", "WISE", "WITTY", "WOBBLY", "WONDERFUL", "WOODEN", "WORRIED", "WORTHLESS", "WORTHY", "WOUNDED", "WRATHFUL", "WRETCHED", "WRONG", "YELLOW", "YOUNG", "YOUTHFUL", "YUMMY", "ZANY", "ZEALOUS"
  ],
  static: [
    "A LONG TIME AGO IN A GALAXY FAR FAR AWAY",
    "ALL YOUR BASE ARE BELONG TO US",
    "BE THE CHANGE YOU WISH TO SEE IN THE WORLD",
    "HELLO WORLD",
    "IN THE BEGINNING",
    "IT WAS A DARK AND STORMY NIGHT",
    "LOREM IPSUM DOLOR SIT AMET",
    "MAY THE FORCE BE WITH YOU",
    "MORSE CODE IS FUN",
    "NEVER GONNA GIVE YOU UP",
    "ONCE UPON A TIME",
    "PRACTICE MAKES PERFECT",
    "SOS SOS",
    "THE CAKE IS A LIE",
    "THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG",
    "TO BE OR NOT TO BE",
    "TO BOLDLY GO WHERE NO ONE HAS GONE BEFORE",
    "WAR IS PEACE FREEDOM IS SLAVERY IGNORANCE IS STRENGTH",
    "WE HOLD THESE TRUTHS TO BE SELF-EVIDENT",
    "WINTER IS COMING"
  ]
       };
        function getRandomElement(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        function generateRandomSentence() {
            const structureId = Math.floor(Math.random() * 5);
            if (structureId === 0 && sentenceParts.static.length > 0) {
                return getRandomElement(sentenceParts.static);
            }
            const subject = getRandomElement(sentenceParts.subjects);
            const verb = getRandomElement(sentenceParts.verbs);
            const object = getRandomElement(sentenceParts.objects);
            const adjective = getRandomElement(sentenceParts.adjectives);
            switch (structureId) {
                case 1: return `${adjective} ${subject} ${verb}`;
                case 2: return `${subject} ${verb} ${object}`;
                case 3: return `${subject} ${verb} A ${adjective} ${object}`;
                case 4: return `${subject} ${verb}`;
                default: return `${subject} ${verb} ${object}`;
            }
        }
        
        let gameState = {};
        let settings = {};
        let stats = {};

        function init() {
            loadSettingsAndStats();
            updateUI();
            populateReference();
            addEventListeners();
            showStartScreen();
        }

        function loadSettingsAndStats() {
            const today = new Date().toDateString();
            settings = { isSoundEnabled: localStorage.getItem('isSoundEnabled') !== 'false' };
            stats = {
                daysLearning: parseInt(localStorage.getItem('daysLearning')) || 0,
                lastVisit: localStorage.getItem('lastVisit') || today,
                dayIncremented: localStorage.getItem('lastVisit') === today && localStorage.getItem('dayIncremented') === 'true',
                totalTime: localStorage.getItem('lastVisit') === today ? parseInt(localStorage.getItem('todayTime')) || 0 : 0,
                dailyProgress: localStorage.getItem('lastVisit') === today ? parseInt(localStorage.getItem('dailyProgress')) || 0 : 0,
                dailyGoal: 5,
                accuracy: 0
            };
             if (stats.lastVisit !== today) {
                stats.lastVisit = today;
                stats.dayIncremented = false; // Important: Reset flag on new day
                saveStats();
            }
        }

        function saveSettings() { localStorage.setItem('isSoundEnabled', settings.isSoundEnabled); }
        function saveStats() {
            localStorage.setItem('daysLearning', stats.daysLearning);
            localStorage.setItem('todayTime', stats.totalTime);
            localStorage.setItem('dailyProgress', stats.dailyProgress);
            localStorage.setItem('lastVisit', stats.lastVisit);
            localStorage.setItem('dayIncremented', stats.dayIncremented.toString()); // Save as string
        }

        function updateUI() {
            document.getElementById('daysLearning').textContent = stats.daysLearning;
            document.getElementById('totalTime').textContent = stats.totalTime;
            document.getElementById('dailyGoalDisplay').textContent = stats.dailyGoal;
            document.getElementById('dailyGoalCount').textContent = stats.dailyGoal;
            document.getElementById('dailyProgress').textContent = stats.dailyProgress;
            document.getElementById('accuracy').textContent = stats.accuracy + '%';
            
            const soundBtn = document.getElementById('soundToggleBtn');
            soundBtn.textContent = settings.isSoundEnabled ? 'üîä' : 'üîá';
            soundBtn.classList.toggle('off', !settings.isSoundEnabled);
        }

        function toggleSound() {
            settings.isSoundEnabled = !settings.isSoundEnabled;
            saveSettings();
            updateUI();
        }

        function showSection(section, event) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) event.target.classList.add('active');
            if (section === 'lesson') { hideAllScreens(); showStartScreen(); } 
            else if (section === 'reference') { hideAllScreens(); document.getElementById('referenceSection').classList.add('active'); }
        }

        function hideAllScreens() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('lessonArea').classList.remove('active');
            document.getElementById('completionScreen').classList.remove('active');
            document.getElementById('referenceSection').classList.remove('active');
        }

        function showStartScreen() { hideAllScreens(); document.getElementById('startScreen').style.display = 'block'; updateProgress(); }

        function startLesson(mode) {
            hideAllScreens();
            document.getElementById('lessonArea').classList.add('active');
            gameState = {
                currentQuestion: 0,
                totalQuestions: mode === 'sentence' ? 10 : 15,
                correctAnswers: 0,
                practiceMode: mode,
                sessionStartTime: Date.now(),
            };
            nextQuestion();
        }

        function nextQuestion() {
            if (gameState.currentQuestion >= gameState.totalQuestions) { completeLesson(); return; }
            gameState.currentQuestion++;
            generateQuestion();
            updateProgress();
            clearFeedback();
        }

        function textToMorseSentence(text) { return text.toUpperCase().split(' ').map(word => word.split('').map(char => morseCode[char]).join(' ')).join(' / '); }

        function generateQuestion() {
            let characterSet, lessonTitle, selectedItem;
            gameState.questionType = ['textToMorse', 'morseToText'][Math.floor(Math.random() * 2)];

            switch (gameState.practiceMode) {
                case 'alphabet': characterSet = Object.keys(morseCode).filter(c => /[A-Z]/.test(c)); lessonTitle = "Alphabet"; break;
                case 'numbers': characterSet = Object.keys(morseCode).filter(c => /[0-9]/.test(c)); lessonTitle = "Number"; break;
                case 'symbols': characterSet = Object.keys(morseCode).filter(c => !/[A-Z0-9\s]/.test(c)); lessonTitle = "Symbol"; break;
                case 'sentence': lessonTitle = "Sentence"; break;
                default: characterSet = Object.keys(morseCode).filter(c => c !== ' '); lessonTitle = "Mixed"; break;
            }

            if (gameState.practiceMode === 'sentence') {
                selectedItem = generateRandomSentence();
            } else {
                selectedItem = getRandomElement(characterSet);
            }
            
            if (gameState.questionType === 'textToMorse') {
                gameState.questionText = selectedItem;
                gameState.currentAnswer = gameState.practiceMode === 'sentence' ? textToMorseSentence(selectedItem) : morseCode[selectedItem];
                document.getElementById('questionText').innerHTML = `<strong>${selectedItem}</strong>`;
                document.getElementById('morseInputArea').style.display = 'block';
                document.getElementById('textInputArea').style.display = 'none';
            } else {
                gameState.currentAnswer = selectedItem;
                gameState.questionText = gameState.practiceMode === 'sentence' ? textToMorseSentence(selectedItem) : morseCode[selectedItem];
                document.getElementById('questionText').innerHTML = `<span class="morse-display">${gameState.questionText}</span>`;
                document.getElementById('morseInputArea').style.display = 'none';
                document.getElementById('textInputArea').style.display = 'block';
                document.getElementById('textInput').value = '';
                document.getElementById('textInput').focus();
            }
            document.getElementById('questionType').textContent = `${lessonTitle} Practice: ${gameState.questionType === 'textToMorse' ? 'Text to Morse' : 'Morse to Text'}`;
            clearInput();
        }

        function addMorse(symbol) {
            gameState.morseInput = (gameState.morseInput || '') + symbol;
            document.getElementById('morseInputDisplay').textContent = gameState.morseInput;
            if ('vibrate' in navigator) navigator.vibrate(50);
            playMorseSound(symbol);
        }

        function playMorseSound(symbol) {
            if (!settings.isSoundEnabled) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime); // Louder volume
                const duration = symbol === '.' ? 0.1 : symbol === '-' ? 0.3 : 0.05;
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) { console.error("Could not play sound:", e); }
        }

        function clearInput() {
            gameState.morseInput = '';
            document.getElementById('morseInputDisplay').textContent = '';
            document.getElementById('textInput').value = '';
        }

        function submitAnswer() {
            let userAnswer, correctAnswer = gameState.currentAnswer;
            if (gameState.questionType === 'textToMorse') {
                userAnswer = (gameState.morseInput || '').trim().replace(/\s+/g, ' ');
                correctAnswer = correctAnswer.replace(/\s+/g, ' ');
            } else {
                userAnswer = document.getElementById('textInput').value.toUpperCase().trim();
            }
            
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                gameState.correctAnswers++;
                showFeedback('‚úÖ Correct!', 'correct');
            } else {
                showFeedback(`‚ùå Incorrect. The answer is: ${correctAnswer}`, 'incorrect');
            }
            
            setTimeout(nextQuestion, 2000);
        }

        function skipQuestion() {
            showFeedback(`‚è≠ Skipped. The answer was: ${gameState.currentAnswer}`, 'incorrect');
            setTimeout(nextQuestion, 2000);
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.style.display = 'block';
        }

        function clearFeedback() {
            document.getElementById('feedback').style.display = 'none';
        }

        function updateProgress() {
            if (!gameState || !gameState.currentQuestion) {
                 document.getElementById('progressFill').style.width = '0%';
                 document.getElementById('progressText').textContent = 'Ready to start!';
                 return;
            }
            const progress = (gameState.currentQuestion / gameState.totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${gameState.currentQuestion} of ${gameState.totalQuestions}`;
        }

        function completeLesson() {
            hideAllScreens();
            document.getElementById('completionScreen').classList.add('active');
            
            const accuracy = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100);
            stats.accuracy = accuracy;
            
            if (!stats.dayIncremented) {
                stats.daysLearning++;
                stats.dayIncremented = true;
                const daysLearningEl = document.getElementById('daysLearning');
                daysLearningEl.classList.add('glow-animation');
                daysLearningEl.addEventListener('animationend', () => daysLearningEl.classList.remove('glow-animation'), { once: true });
            }

            if (accuracy >= 80) stats.dailyProgress = Math.min(stats.dailyProgress + 1, stats.dailyGoal);
            stats.totalTime += Math.round((Date.now() - gameState.sessionStartTime) / 60000) || 1;
            
            document.getElementById('finalScore').textContent = accuracy + '%';
            document.getElementById('completionMessage').textContent = accuracy >= 90 ? 'üåü Excellent! You\'re mastering Morse code!' :
                                                                    accuracy >= 80 ? 'üëç Great job! Keep up the good work!' :
                                                                    accuracy >= 60 ? 'üìö Good effort! Practice makes perfect!' :
                                                                    'üí™ Keep practicing! You\'ll improve with time!';
            saveStats();
            updateUI();
        }

        function populateReference() {
            const letters = Object.entries(morseCode).filter(([c]) => /[A-Z]/.test(c));
            const numbers = Object.entries(morseCode).filter(([c]) => /[0-9]/.test(c));
            const symbols = Object.entries(morseCode).filter(([c]) => !/[A-Z0-9\s]/.test(c));
            
            populateReferenceSection('lettersReference', letters);
            populateReferenceSection('numbersReference', numbers);
            populateReferenceSection('symbolsReference', symbols);
        }

        function populateReferenceSection(elementId, items) {
            const container = document.getElementById(elementId);
            container.innerHTML = items.map(([char, morse]) => 
                `<div class="morse-item"><span><strong>${char === ' ' ? 'Space' : char}</strong></span><span style="font-family: 'Courier New', monospace;">${morse}</span></div>`
            ).join('');
        }

        function addEventListeners() {
            document.getElementById('soundToggleBtn').addEventListener('click', toggleSound);
            document.addEventListener('keydown', (e) => {
                if (document.getElementById('textInput').isSameNode(document.activeElement)) return;
                if (e.code === 'Space') { e.preventDefault(); if (document.getElementById('morseInputArea').style.display !== 'none') addMorse(' '); } 
                else if (e.key === '.') { e.preventDefault(); addMorse('.'); } 
                else if (e.key === '-') { e.preventDefault(); addMorse('-'); } 
                else if (e.key === 'Enter') { e.preventDefault(); submitAnswer(); }
            });
            document.getElementById('textInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') submitAnswer(); });
        }

        init();
    </script>
</body>
</html>